{% if previews %}
  {% for item in previews %}
    {% set duplicates = item.duplicates or [] %}
    <div
      class="bg-slate-50 border border-slate-200 rounded-lg p-4"
      {% if duplicates %}data-duplicate-hit="1"{% endif %}
      {% if item.upload_token %}data-upload-token="{{ item.upload_token }}"{% endif %}
    >
      <div class="font-semibold text-slate-900 mb-3 truncate" title="{{ item.filename or item.title }}">{{ item.filename or item.title }}</div>
      {% if item.error %}
        <div class="mb-3 text-sm text-red-600">{{ item.error }}</div>
      {% endif %}
      {% if duplicates %}
        <div class="mb-3 rounded-lg border border-amber-300 bg-amber-50 px-3 py-2 text-xs text-amber-800">
          检测到疑似重复书籍：
          {% for dup in duplicates %}
            <a class="underline decoration-dotted hover:text-amber-900" href="/book/{{ dup.book_id }}">{{ dup.title }}（{{ dup.author }}）</a>{% if not loop.last %}；{% endif %}
          {% endfor %}
        </div>
      {% endif %}
      <dl class="grid grid-cols-1 md:grid-cols-2 gap-3 text-sm">
        <div>
          <dt class="text-xs font-semibold text-slate-500 uppercase">格式</dt>
          <dd class="text-slate-700 font-mono">{{ item.format or "—" }}</dd>
        </div>
        <div>
          <dt class="text-xs font-semibold text-slate-500 uppercase">识别标题</dt>
          <dd class="text-slate-700">{{ item.title or "—" }}</dd>
        </div>
        <div>
          <dt class="text-xs font-semibold text-slate-500 uppercase">作者</dt>
          <dd class="text-slate-700">{{ item.author or "未知" }}</dd>
        </div>
        <div>
          {% if item.format == "EPUB" %}
            <dt class="text-xs font-semibold text-slate-500 uppercase">章节</dt>
            <dd class="text-slate-700">{{ item.chapters }}</dd>
          {% else %}
            <dt class="text-xs font-semibold text-slate-500 uppercase">卷/章</dt>
            <dd class="text-slate-700">{{ item.volumes }} / {{ item.chapters }}</dd>
          {% endif %}
        </div>
        <div>
          <dt class="text-xs font-semibold text-slate-500 uppercase">输出文件</dt>
          <dd class="text-slate-700 font-mono truncate" title="{{ item.output }}">{{ item.output }}</dd>
        </div>
        <div>
          <dt class="text-xs font-semibold text-slate-500 uppercase">落库路径</dt>
          <dd class="text-slate-700 font-mono truncate" title="{{ item.path }}">{{ item.path }}</dd>
        </div>
      </dl>
      {% if item.toc %}
        <div class="mt-4 pt-3 border-t border-slate-200">
          <h4 class="text-sm font-semibold text-slate-900 mb-2">TOC 前 10 条</h4>
          <ul class="list-disc pl-5 text-sm text-slate-600 space-y-1">
            {% for title in item.toc %}
              <li>{{ title }}</li>
            {% endfor %}
          </ul>
        </div>
      {% endif %}
    </div>
  {% endfor %}
{% else %}
  <div class="text-sm text-slate-500 text-center py-6">没有可预览的内容。</div>
{% endif %}
