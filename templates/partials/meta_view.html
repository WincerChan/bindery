{% set rating = book.rating %}
<div id="meta-panel" class="bg-white p-6 rounded-xl shadow-sm border border-slate-200">
  <div class="flex justify-between items-center mb-6">
    <div class="flex items-start gap-4 min-w-0">
      <div class="w-20 sm:w-24 aspect-[2/3] rounded-lg overflow-hidden border border-slate-200 bg-slate-100 shadow-sm shrink-0">
        {% if book.cover_url %}
          <img src="{{ book.cover_url }}" alt="{{ book.title }}" class="w-full h-full object-cover" />
        {% else %}
          <div class="w-full h-full flex flex-col items-center justify-center text-slate-400 p-3 text-center">
            <div class="w-9 h-9 bg-slate-200 rounded-lg flex items-center justify-center text-slate-500 font-bold text-lg mb-2">B</div>
            <span class="text-[10px] font-mono line-clamp-2">{{ book.title }}</span>
          </div>
        {% endif %}
      </div>
      <div class="min-w-0">
        <h2 class="text-xl font-bold text-slate-900 truncate">{{ book.title }}</h2>
        <div class="mt-1 flex flex-wrap items-center gap-2 text-xs text-slate-500">
          <span class="truncate">{{ book.author or "未知" }}</span>
          <span class="text-slate-300">·</span>
          <span>{{ book.language }}</span>
        </div>
      </div>
    </div>
    <a
      class="px-4 py-2 text-sm bg-indigo-50 text-indigo-700 rounded-lg hover:bg-indigo-100 font-medium transition-colors"
      href="/book/{{ book_id }}/edit"
      hx-get="/book/{{ book_id }}/edit"
      hx-target="#meta-panel"
      hx-swap="innerHTML"
    >编辑</a>
  </div>

  <dl class="grid md:grid-cols-2 gap-6 text-sm">
    <div class="space-y-1">
      <dt class="text-xs font-semibold text-slate-500 uppercase">作者</dt>
      <dd class="text-slate-700">{{ book.author or "未知" }}</dd>
    </div>
    <div class="space-y-1">
      <dt class="text-xs font-semibold text-slate-500 uppercase">语言</dt>
      <dd class="text-slate-700">{{ book.language }}</dd>
    </div>
    <div class="space-y-1">
      <dt class="text-xs font-semibold text-slate-500 uppercase">系列</dt>
      <dd class="text-slate-700">{{ book.series or "—" }}</dd>
    </div>
    <div class="space-y-1">
      <dt class="text-xs font-semibold text-slate-500 uppercase">Identifier</dt>
      <dd class="text-slate-700 font-mono break-all">{{ book.identifier or "—" }}</dd>
    </div>
    <div class="space-y-1">
      <dt class="text-xs font-semibold text-slate-500 uppercase">出版社</dt>
      <dd class="text-slate-700">{{ book.publisher or "—" }}</dd>
    </div>
    <div class="space-y-1">
      <dt class="text-xs font-semibold text-slate-500 uppercase">标签</dt>
      <dd class="text-slate-700">{{ book.tags | join(", ") if book.tags else "—" }}</dd>
    </div>
    <div class="space-y-1">
      <dt class="text-xs font-semibold text-slate-500 uppercase">发表时间</dt>
      <dd class="text-slate-700">{{ book.published or "—" }}</dd>
    </div>
    <div class="space-y-1">
      <dt class="text-xs font-semibold text-slate-500 uppercase">ISBN</dt>
      <dd class="text-slate-700 font-mono break-all">{{ book.isbn or "—" }}</dd>
    </div>
    <div class="space-y-1">
      <dt class="text-xs font-semibold text-slate-500 uppercase">规则模板</dt>
      <dd class="text-slate-700 font-mono">{{ book.rule_template or "—" }}</dd>
    </div>
    <div class="space-y-1">
      <dt class="text-xs font-semibold text-slate-500 uppercase">状态</dt>
      <dd class="text-slate-700">{{ book.status_label }}</dd>
    </div>
    <div class="space-y-1">
      <dt class="text-xs font-semibold text-slate-500 uppercase">星级</dt>
      <dd class="text-amber-500">
        {% if rating is not none %}
          {% for _ in range(rating) %}★{% endfor %}
          <span class="text-slate-300">{% for _ in range(5 - rating) %}★{% endfor %}</span>
        {% else %}
          <span class="text-slate-500">未评分</span>
        {% endif %}
      </dd>
    </div>
  </dl>

  {% if book.description %}
    <div class="mt-6 pt-5 border-t border-slate-100">
      <h3 class="text-sm font-semibold text-slate-900 mb-2">简介</h3>
      <p class="text-sm text-slate-600 leading-relaxed whitespace-pre-wrap">{{ book.description }}</p>
    </div>
  {% endif %}
</div>
